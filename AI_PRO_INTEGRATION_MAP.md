# ğŸ—ºï¸ AI PRO IMPLEMENTATION - COMPLETE INTEGRATION MAP

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DENTAL APP - AI PRO                         â”‚
â”‚                    Complete Integration Map                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DATA LAYER              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Firestore (clinics/{id})    â”‚
â”‚   â”œâ”€ includeAIPro (bool)   â”‚
â”‚   â”œâ”€ subscriptionPlan       â”‚
â”‚   â””â”€ subscriptionPrice      â”‚
â”‚                             â”‚
â”‚ AsyncStorage               â”‚
â”‚   â”œâ”€ clinicIncludeAIPro    â”‚
â”‚   â”œâ”€ clinicTier            â”‚
â”‚   â””â”€ aiProAnalyticsLogs    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   STATE MANAGEMENT          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ useAIProStatus Hook        â”‚
â”‚   â””â”€ Returns: {            â”‚
â”‚       hasAIPro: boolean    â”‚
â”‚       aiProPrice: 9.99     â”‚
â”‚       isLoading            â”‚
â”‚       error                â”‚
â”‚     }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚               â”‚
      â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENTS   â”‚ â”‚ UTILITIES        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚ â”‚                  â”‚
â”‚ AIProBanner  â”‚ â”‚ aiProAnalytics   â”‚
â”‚ â”œâ”€ Visible   â”‚ â”‚ â”œâ”€ Track events  â”‚
â”‚ â””â”€ OnPress   â”‚ â”‚ â””â”€ Store logs    â”‚
â”‚              â”‚ â”‚                  â”‚
â”‚ AIProUpgrade â”‚ â”‚ aiAssistant      â”‚
â”‚ Prompt       â”‚ â”‚ â”œâ”€ Stream setup  â”‚
â”‚ â”œâ”€ Modal     â”‚ â”‚ â””â”€ Include flag  â”‚
â”‚ â””â”€ Features  â”‚ â”‚                  â”‚
â”‚              â”‚ â”‚                  â”‚
â”‚ AIProFeature â”‚ â”‚                  â”‚
â”‚ Gate         â”‚ â”‚                  â”‚
â”‚ â”œâ”€ Lock      â”‚ â”‚                  â”‚
â”‚ â””â”€ Unlock    â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SCREENS          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                  â”‚
        â”‚ Home Screen      â”‚
        â”‚ â”œâ”€ AIProBanner   â”‚
        â”‚ â””â”€ Navigation    â”‚
        â”‚                  â”‚
        â”‚ AI Chat Screen   â”‚
        â”‚ â”œâ”€ Integration   â”‚
        â”‚ â”œâ”€ Upgrade Promptâ”‚
        â”‚ â””â”€ Messages      â”‚
        â”‚                  â”‚
        â”‚ Any Screen       â”‚
        â”‚ â””â”€ AIProFeature  â”‚
        â”‚    Gate          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CLOUD FUNCTION   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                  â”‚
        â”‚ Receives:        â”‚
        â”‚ â”œâ”€ message       â”‚
        â”‚ â””â”€ includeAIPro  â”‚
        â”‚                  â”‚
        â”‚ If Pro=true:     â”‚
        â”‚ â””â”€ Advanced      â”‚
        â”‚    features      â”‚
        â”‚                  â”‚
        â”‚ Returns:         â”‚
        â”‚ â””â”€ AI response   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Sequences

### Sequence 1: User Opens App (Initialization)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Opens App                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useAuth() Hook        â”‚
        â”‚ â”œâ”€ Gets clinicId      â”‚
        â”‚ â””â”€ Gets userRole      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useAIProStatus Hook   â”‚
        â”‚ â”œâ”€ Check clinicId     â”‚
        â”‚ â””â”€ Fetch Firestore    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Successâ”‚         â”‚ Firestore Err? â”‚
    â”‚        â”‚         â”‚                â”‚
    â”‚ Cache  â”‚         â”‚ Load from      â”‚
    â”‚ to     â”‚         â”‚ AsyncStorage   â”‚
    â”‚ Storageâ”‚         â”‚ (offline)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ App State Updated     â”‚
        â”‚ hasAIPro = true/false â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Home Pageâ”‚         â”‚ Home Pageâ”‚
    â”‚ Shows:   â”‚         â”‚ Shows:   â”‚
    â”‚ â”œâ”€Banner â”‚         â”‚ â””â”€No     â”‚
    â”‚ â””â”€Pro UX â”‚         â”‚   Banner â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sequence 2: User Without Pro Tries AI Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks "AI Chat" (No Pro)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AI Chat Screen Loads  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ hasAIAccess = false   â”‚
        â”‚ (from subscription)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Show Upgrade Notice   â”‚
        â”‚ - "Upgrade to AI Pro" â”‚
        â”‚ - Feature list        â”‚
        â”‚ - [Upgrade Now]       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Clicks           â”‚
        â”‚ "Upgrade Now"         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AIProUpgradePrompt    â”‚
        â”‚ Modal Opens           â”‚
        â”‚ - Shows benefits      â”‚
        â”‚ - Shows pricing       â”‚
        â”‚ - [Get AI Pro]        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Clicks     â”‚      â”‚ User Clicks      â”‚
â”‚ "Not Now"       â”‚      â”‚ "Get AI Pro"     â”‚
â”‚                 â”‚      â”‚                  â”‚
â”‚ Modal Closes    â”‚      â”‚ Analytics:       â”‚
â”‚                 â”‚      â”‚ Track: clicked   â”‚
â”‚                 â”‚      â”‚                  â”‚
â”‚                 â”‚      â”‚ Navigate to:     â”‚
â”‚                 â”‚      â”‚ /clinic/subscribeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Subscription     â”‚
                        â”‚ Flow             â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sequence 3: User With Pro Uses AI Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User With Pro Clicks "AI Chat"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useAIProStatus Hook   â”‚
        â”‚ hasAIPro = true       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AI Chat UI Renders    â”‚
        â”‚ - Full interface      â”‚
        â”‚ - Input field ready   â”‚
        â”‚ - No upgrade notice   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Types Message    â”‚
        â”‚ & Clicks Send         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sendMessageToAIStream â”‚
        â”‚ with context: {       â”‚
        â”‚   message,            â”‚
        â”‚   hasAIPro: true,     â”‚ â† KEY!
        â”‚   ...                 â”‚
        â”‚ }                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Cloud Function        â”‚
        â”‚ Receives:             â”‚
        â”‚ â”œâ”€ message            â”‚
        â”‚ â”œâ”€ includeAIPro: true â”‚
        â”‚ â””â”€ other context      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend Logic:        â”‚
        â”‚ if (includeAIPro) {   â”‚
        â”‚   advanced_response() â”‚
        â”‚ } else {              â”‚
        â”‚   basic_response()    â”‚
        â”‚ }                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Return AI Response    â”‚
        â”‚ - Streamed to app     â”‚
        â”‚ - Displayed in UI     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Analytics Tracked     â”‚
        â”‚ - ai_chat_started     â”‚
        â”‚ - ai_feature_used     â”‚
        â”‚ (if Pro feature)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sequence 4: User Clicks AI Pro Banner

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User With Pro on Home Screen            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ AI Pro Banner         â”‚
        â”‚ Renders (visible=true)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useEffect Triggers    â”‚
        â”‚ Analytics:            â”‚
        â”‚ trackAIProBanner      â”‚
        â”‚ Shown()               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Clicks Banner    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Analytics:            â”‚
        â”‚ trackAIProBanner      â”‚
        â”‚ Clicked()             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ onPress Callback      â”‚
        â”‚ (passed from home)    â”‚
        â”‚ router.push(ai_tab)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Navigate to           â”‚
        â”‚ AI Chat Screen        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Dependency Graph

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   App (Root)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚            â”‚            â”‚
            â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Home â”‚   â”‚ Chat â”‚    â”‚ Clinic   â”‚
        â”‚Screenâ”‚   â”‚Screenâ”‚    â”‚ Screens  â”‚
        â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚          â”‚             â”‚
           â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚          â”‚   â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ useAIPro â”‚   â”‚useAIPro    â”‚       â”‚useAIPro â”‚
    â”‚Status â—„â”€â”€â”¼â”€â”€â”€â”¤Status      â”‚â—„â”€â”€â”¬â”€â”€â”€â”¤Status   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚          â”‚        â”‚     â”‚        â”‚
           â”‚    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”‚     â”‚        â”‚
           â”‚    â”‚AIProUpg   â”‚   â”‚     â”‚        â”‚
           â”‚    â”‚radePrompt â”‚   â”‚     â”‚        â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚     â”‚        â”‚
           â”‚          â”‚        â”‚     â”‚        â”‚
           â”‚    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”   â”‚        â”‚
           â”‚    â”‚aiProAnalytics â”‚   â”‚        â”‚
           â”‚    â”‚  (tracking)   â”‚   â”‚        â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
           â”‚           â”‚            â”‚        â”‚
           â–¼           â–¼            â–¼        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Firestore: clinics/{clinicId}              â”‚
    â”‚ - includeAIPro                             â”‚
    â”‚ - subscriptionPlan                         â”‚
    â”‚ - subscriptionPrice                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State & Props Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore Read                              â”‚
â”‚ clinics/{clinicId}                          â”‚
â”‚ â””â”€ includeAIPro: boolean                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ useAIProStatus Hook â”‚
    â”‚ â”œâ”€ Fetches          â”‚
    â”‚ â”œâ”€ Caches           â”‚
    â”‚ â””â”€ Returns {        â”‚
    â”‚    hasAIPro: bool   â”‚
    â”‚    aiProPrice: 9.99 â”‚
    â”‚    isLoading: bool  â”‚
    â”‚    error: Error?    â”‚
    â”‚  }                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                  â”‚
    â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home Screen  â”‚          â”‚ AI Chat Screen     â”‚
â”‚              â”‚          â”‚                    â”‚
â”‚ const {      â”‚          â”‚ const {            â”‚
â”‚  hasAIPro    â”‚          â”‚  hasAIPro,         â”‚
â”‚ } = hook;    â”‚          â”‚  aiProLoading      â”‚
â”‚              â”‚          â”‚ } = hook;          â”‚
â”‚ render {     â”‚          â”‚                    â”‚
â”‚  hasAIPro && â”‚          â”‚ {aiProLoading ? (  â”‚
â”‚  <AIProBannerâ”‚          â”‚  <Loading/>        â”‚
â”‚              â”‚          â”‚ ) : !hasAI... ? (  â”‚
â”‚ }            â”‚          â”‚  <UpgradeNotice/>  â”‚
â”‚              â”‚          â”‚ ) : (              â”‚
â”‚              â”‚          â”‚  <ChatUI/>         â”‚
â”‚              â”‚          â”‚  <AIProUpgrade     â”‚
â”‚              â”‚          â”‚   Prompt/>         â”‚
â”‚              â”‚          â”‚ )}                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Pass to AI Function  â”‚
                        â”‚                      â”‚
                        â”‚ sendMessageToAIStreamâ”‚
                        â”‚ (msg, {             â”‚
                        â”‚   hasAIPro,  â—„â”€â”€â”   â”‚
                        â”‚   ...            â”‚   â”‚
                        â”‚ })               â”‚   â”‚
                        â”‚                  â”‚   â”‚
                        â”‚ â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚       â”‚              â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Cloud Function       â”‚
                        â”‚                      â”‚
                        â”‚ if (includeAIPro) {  â”‚
                        â”‚   // Advanced        â”‚
                        â”‚ } else {             â”‚
                        â”‚   // Basic           â”‚
                        â”‚ }                    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature Gating Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User wants to use feature           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Wrap with            â”‚
    â”‚ AIProFeatureGate     â”‚
    â”‚ hasAIPro={bool}      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
       â–¼               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ hasAIProâ”‚   â”‚ hasAIPro     â”‚
   â”‚ =true   â”‚   â”‚ =false       â”‚
   â”‚         â”‚   â”‚              â”‚
   â”‚ Render  â”‚   â”‚ Render       â”‚
   â”‚ Feature â”‚   â”‚ Locked State â”‚
   â”‚ Normallyâ”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚         â”‚   â”‚ â”‚ğŸ”’Premium â”‚ â”‚
   â”‚         â”‚   â”‚ â”‚Feature   â”‚ â”‚
   â”‚         â”‚   â”‚ â”‚          â”‚ â”‚
   â”‚         â”‚   â”‚ â”‚[Get Pro] â”‚ â”‚
   â”‚         â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â”‚         â”‚   â”‚              â”‚
   â”‚         â”‚   â”‚ (Content     â”‚
   â”‚         â”‚   â”‚  dimmed)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚
       â”‚               â–¼
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚ User clicks â”‚
       â”‚         â”‚ "Get Pro"   â”‚
       â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚ showUpgrade      â”‚
       â”‚         â”‚ Prompt = true    â”‚
       â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         â”‚ Modal Opens      â”‚
       â”‚         â”‚ - Benefits       â”‚
       â”‚         â”‚ - Pricing        â”‚
       â”‚         â”‚ [Get AI Pro]     â”‚
       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€ Feature executes
          as normal
```

---

## Key Integration Points

### 1. Firestore Integration
**Location:** useAIProStatus hook  
**Reads:** `clinics/{clinicId}.includeAIPro`  
**Caches:** AsyncStorage keys  
**Updates:** React state (hasAIPro)

### 2. Backend Integration
**Location:** aiAssistant.ts  
**Sends:** `includeAIPro: boolean` in request body  
**Receives:** AI response with feature unlock

### 3. UI Integration
**Location:** Home & AI Chat screens  
**Components:** AIProBanner, AIProUpgradePrompt  
**Control:** hasAIPro state variable

### 4. Analytics Integration
**Location:** aiProAnalytics.ts  
**Stores:** AsyncStorage 'aiProAnalyticsLogs'  
**Tracks:** 8 event types  
**Ready for:** Firebase Analytics SDK

---

## Localization Keys Mapping

```
en.json & ar.json
â”œâ”€â”€ ai.featureGating
â”‚   â”œâ”€â”€ proFeatureOnly
â”‚   â”œâ”€â”€ upgradePrompt
â”‚   â”œâ”€â”€ upgradeButton
â”‚   â”œâ”€â”€ limitedAccess
â”‚   â””â”€â”€ baseFeaturesAvailable
â””â”€â”€ ai.analytics
    â”œâ”€â”€ aiProSelected
    â”œâ”€â”€ aiProUpgraded
    â”œâ”€â”€ aiFeatureUsed
    â””â”€â”€ aiChatStarted
```

---

## Environment & Configuration

```
Required Environment:
â”œâ”€ React Native (Expo)
â”œâ”€ Firebase/Firestore
â”œâ”€ AsyncStorage
â””â”€ i18n (i18next)

Optional:
â”œâ”€ Firebase Analytics
â””â”€ Sentry (Error tracking)

Configuration:
â”œâ”€ useAIProStatus reads from Firestore
â”œâ”€ Cloud Function endpoint in AI_CHAT_ENDPOINT
â””â”€ Localization in locales/{lang}.json
```

---

## Error Handling Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Occursâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firestore   â”‚   â”‚ Cloud      â”‚
â”‚ Error       â”‚   â”‚ Function   â”‚
â”‚             â”‚   â”‚ Error      â”‚
â”‚ Strategy:   â”‚   â”‚            â”‚
â”‚ â”œâ”€ Log      â”‚   â”‚ Strategy:  â”‚
â”‚ â”œâ”€ Fall backâ”‚   â”‚ â”œâ”€ Log     â”‚
â”‚ â”‚ to cache  â”‚   â”‚ â”œâ”€ Retry   â”‚
â”‚ â””â”€ Continue â”‚   â”‚ â””â”€ Fallbackâ”‚
â”‚   (offline) â”‚   â”‚ (mock API) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result:
- App continues functioning
- Offline mode supported
- Graceful degradation
```

---

## Performance Optimization

```
Strategy               Location          Impact
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Firestore caching      useAIProStatus    â–¼ Queries
AsyncStorage           Offline mode      â–¼ Network
Memoization            Components        â–¼ Re-renders
Event batching         Analytics         â–¼ Requests
Lazy loading           Modals            â–¼ Bundle size
```

---

*Complete integration map showing all connections, data flows, and dependencies.*
