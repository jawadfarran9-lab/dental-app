# 🎨 رسم بياني – مسار صاحب العيادة الكامل

---

## 🔄 المسار الكامل من البداية إلى النهاية

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        🏥 تجربة صاحب العيادة (Clinic Owner)                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                        1️⃣ شاشة الترحيب (Welcome Screen)                      │
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                          الترحيب والاختيار                              │ │
│  │  ┌──────────────────────┐           ┌──────────────────────┐            │ │
│  │  │  👨‍⚕️ أنا طبيب/عيادة    │           │   👤 أنا مريض        │            │ │
│  │  │  (I'm a Doctor)      │           │  (I'm a Patient)    │            │ │
│  │  │ [زر يتصل بـ الاختيار] │           │ [زر يتصل بـ الاختيار]│            │ │
│  │  └────────────┬─────────┘           └──────────┬──────────┘            │ │
│  │             │                                  │                        │ │
│  │    [يعيّن role = 'clinicOwner']      [يعيّن role = 'patient']          │ │
│  │             │                                  │                        │ │
│  └─────────────┼──────────────────────────────────┼────────────────────────┘ │
│                │                                  │                          │
│                ▼                                  ▼                          │
│          يوجه إلى:                          يوجه إلى:                        │
│         /clinic/setup                       /(tabs)/home                   │
│         (أو /clinic/login)                  ثم /patient                    │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                    2️⃣ تسجيل الدخول (Clinic Login)                           │
│                         app/clinic/login.tsx (246 سطر)                      │
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                     📧 البريد الإلكتروني                               │ │
│  │                 [____________@clinic.com_________]                    │ │
│  │                                                                       │ │
│  │                     🔐 كلمة المرور                                    │ │
│  │                 [_________••••••••_________]                         │ │
│  │                                                                       │ │
│  │                    [تسجيل الدخول]                                   │ │
│  │                           │                                          │ │
│  │              استعلام Firestore عن المطابقة                         │ │
│  │                           │                                          │ │
│  │                  ✅ نجاح؟  │  ❌ فشل؟                              │ │
│  │                           │                                          │ │
│  └─────────────────┬──────────────────────┬───────────────────────────┘ │
│                    │                      │                              │
│                    ▼                      ▼                              │
│          تحديث AuthContext          عرض رسالة خطأ                        │
│        + حفظ clinicId                                                    │
│                    │                      │                              │
│                    └────────┬─────────────┘                              │
│                             │                                            │
│                             ▼                                            │
│                    يوجه إلى: /clinic                                     │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                 3️⃣ لوحة المرضى الرئيسية (Clinic Home Dashboard)              │
│                         app/clinic/index.tsx (565 سطر)                      │
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ ┌─────────────────────────────────────────────────────────────────┐   │ │
│  │ │           📸 صورة العيادة (Hero Image)                         │   │ │
│  │ │              اسم العيادة "عيادة البسمة"                        │   │ │
│  │ │  @clinic_admin  |  Logout                                     │   │ │
│  │ └─────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                       │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────┐ │ │
│  │  │     ⚙️       │  │     👨‍⚕️      │  │      🆕      │  │   💬     │ │ │
│  │  │  Settings    │  │  Create Dr.  │  │   Patient    │  │  Messages│ │ │
│  │  │  مع تحقق ✓   │  │  (مع تحقق)   │  │  مريض جديد   │  │  الرسائل │ │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────┘ │ │
│  │         │                 │                 │                │        │ │
│  │         ▼                 ▼                 ▼                ▼        │ │
│  │      Settings        Team Page        Create Patient    Messages Hub │ │
│  │   + Auth Prompt    + Auth Prompt                                      │ │
│  │                                                                       │ │
│  │  ┌────────────────────────────────────────────────────────────────┐ │ │
│  │  │           📊 شبكة المرضى (Patient Grid - 3 في كل صف)         │ │ │
│  │  │                                                               │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │ │
│  │  │  │    John     │  │    Sarah    │  │    Ahmed    │         │ │ │
│  │  │  │   (رمز 123) │  │   (رمز 456) │  │   (رمز 789) │         │ │ │
│  │  │  │  [صورة]     │  │  [صورة]     │  │  [صورة]     │         │ │ │
│  │  │  │ [اضغط]      │  │ [اضغط]      │  │ [اضغط]      │         │ │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │ │
│  │  │                                                               │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │ │
│  │  │  │    Maria    │  │     Alex    │  │    Lisa     │         │ │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │ │
│  │  │                                                               │ │ │
│  │  │              [تحميل المزيد...]                             │ │ │
│  │  └────────────────────────────────────────────────────────────┘ │ │
│  │                                                                   │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                      │ │
│  │  │ 🏥 اليوم (5)     │  │ 📋 إجمالي (45)  │                      │ │
│  │  │ مرضى جدد       │  │ مرضى في النظام   │                      │ │
│  │  └─────────────────┘  └─────────────────┘                      │ │
│  │                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────┐ │ │
│  │  │              شريط الأزرار السفلي (اختياري)                  │ │ │
│  │  │  [Clinic] [Doctor] [Patient] [Messages]                   │ │ │
│  │  └─────────────────────────────────────────────────────────────┘ │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                        │
│  عند الضغط على مريض:                                               │
│                                                                        │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                   4️⃣ تفاصيل المريض (Patient Details)                         │
│               app/clinic/[patientId].tsx (800+ سطر) ✅ كامل             │
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                      🖼️ صورة المريض (Hero)                            │ │
│  │                     📛 الاسم: John Doe                              │ │
│  │                     🔢 الرمز: 1234567890                            │ │
│  │                                                                      │ │
│  │  ┌──────────────────┐        ┌──────────────────┐                 │ │
│  │  │   Sessions       │        │   Messages       │                 │ │
│  │  │   (الجلسات)       │        │   (الرسائل)       │                 │ │
│  │  └──────────────────┘        └──────────────────┘                 │ │
│  │                                                                      │ │
│  │  📍 التبويب 1: الجلسات (Sessions)                                  │ │
│  │  ┌────────────────────────────────────────────────────────────┐   │ │
│  │  │                                                             │   │ │
│  │  │   جلسة #1                                                  │   │ │
│  │  │   📸 [صورة الجلسة]                                          │   │ │
│  │  │   نوع: تنظيف                                               │   │ │
│  │  │   التاريخ: 2026/1/1                                         │   │ │
│  │  │   الدكتور: Dr. Ahmed                                       │   │ │
│  │  │   الملاحظات: اكتمل بنجاح                                    │   │ │
│  │  │                                                             │   │ │
│  │  │   [اضغط] → open imaging viewer + annotations             │   │ │
│  │  │                                                             │   │ │
│  │  │   ─────────────────────────────────────                  │   │ │
│  │  │                                                             │   │ │
│  │  │   جلسة #2                                                  │   │ │
│  │  │   📸 [صورة الجلسة]                                          │   │ │
│  │  │   ... نفس النمط                                            │   │ │
│  │  │                                                             │   │ │
│  │  │   ┌─────────────────────────────────────┐                │   │ │
│  │  │   │  ➕ أضف جلسة جديدة                   │                │   │ │
│  │  │   │  • اسم الدكتور                      │                │   │ │
│  │  │   │  • نوع الجلسة                       │                │   │ │
│  │  │   │  • صور التصوير                      │                │   │ │
│  │  │   │  • الملاحظات                       │                │   │ │
│  │  │   └─────────────────────────────────────┘                │   │ │
│  │  │                                                             │   │ │
│  │  └────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  │  💬 التبويب 2: الرسائل (Messages/Chat)                             │ │
│  │  ┌────────────────────────────────────────────────────────────┐   │ │
│  │  │                                                             │   │ │
│  │  │  Dr. Ahmed: أرسل لك الصور                                 │   │ │
│  │  │  John:      شكراً يا دكتور                                 │   │ │
│  │  │  Dr. Ahmed: متى تريد الجلسة التالية؟                       │   │ │
│  │  │                                                             │   │ │
│  │  │  [__________ اكتب رسالتك هنا ___________]                 │   │ │
│  │  │                                   [إرسال]                 │   │ │
│  │  │                                                             │   │ │
│  │  └────────────────────────────────────────────────────────────┘   │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  عند الضغط على صورة جلسة:                                            │
│                                                                           │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│              5️⃣ عرض الصورة مع التعليقات (Image Viewer)                      │
│         app/clinic/[patientId]/image/[imageId].tsx                         │
│                          ✅ كامل + محمي بـ useClinicGuard                   │
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                         │ │
│  │                          🖼️ صورة الأسنان                              │ │
│  │                      (مع أدوات الرسم للدكتور فقط)                    │ │
│  │                                                                         │ │
│  │  ┌──────────────────────────────────────────────────┐                │ │
│  │  │                                                   │                │ │
│  │  │              📸 صورة الأسنان                      │                │ │
│  │  │        (مع أسهم + دوائر + نصوص توضيحية)         │                │ │
│  │  │                                                   │                │ │
│  │  │                                                   │                │ │
│  │  └──────────────────────────────────────────────────┘                │ │
│  │                                                                         │ │
│  │  أدوات التحرير (للدكتور فقط):                                         │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐                │ │
│  │  │    ✏️     │ │   🗑️     │ │   📝     │ │  💾      │                │ │
│  │  │   رسم     │ │  حذف     │ │   نص     │ │  حفظ     │                │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘                │ │
│  │  ┌──────────┐ ┌──────────┐                                          │ │
│  │  │    ↶     │ │    ↷     │                                          │ │
│  │  │   Undo   │ │   Redo   │                                          │ │
│  │  └──────────┘ └──────────┘                                          │ │
│  │                                                                       │ │
│  │  [← رجوع]                              [حفظ ملاحظات]              │ │
│  │                                                                       │ │
│  │  ⚠️ إذا كان المستخدم مريض:                                        │ │
│  │  ❌ لا أدوات (View-only mode)                                      │ │
│  │  ✅ يشاهد الصورة + الرسومات والملاحظات فقط                          │ │
│  │                                                                       │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                    6️⃣ الصفحات الإضافية الأخرى                             │
│                                                                               │
│  ┌─────────────────────────┐  ┌─────────────────────────┐                 │
│  │   👨‍⚕️ إدارة الفريق       │  │   ⚙️ إعدادات العيادة      │                 │
│  │   (Team Management)     │  │   (Clinic Settings)     │                 │
│  │                         │  │                         │                 │
│  │ ✅ دعوة أعضاء جدد       │  │ ✅ تعديل الصورة          │                 │
│  │ ✅ تغيير الأدوار        │  │ ✅ تعديل الاسم           │                 │
│  │ ✅ إدارة الدعوات        │  │ ✅ الألوان والعلامات     │                 │
│  │ ✅ إزالة الأعضاء       │  │ ✅ معلومات التواصل      │                 │
│  │                         │  │ ✅ أوقات العمل          │                 │
│  │ File: team.tsx          │  │ ✅ الشعار               │                 │
│  │ 419 سطر ✅              │  │                         │                 │
│  │                         │  │ File: settings.tsx      │                 │
│  │                         │  │ 660 سطر ✅              │                 │
│  └─────────────────────────┘  └─────────────────────────┘                 │
│                                                                               │
│  ┌─────────────────────────┐  ┌─────────────────────────┐                 │
│  │   💬 الرسائل (Hub)       │  │   🆕 إنشاء مريض         │                 │
│  │   (Messaging)           │  │   (Create Patient)      │                 │
│  │                         │  │                         │                 │
│  │ ⚠️ قائمة المحادثات      │  │ ✅ إدخال الاسم          │                 │
│  │ ⚠️ آخر رسالة لكل مريض  │  │ ✅ البيانات الشخصية     │                 │
│  │ ⚠️ عد الرسائل الجديدة  │  │ ✅ توليد رمز فريد       │                 │
│  │ ⚠️ يحتاج ربط Firestore│  │ ✅ الحفظ في Firestore   │                 │
│  │                         │  │                         │                 │
│  │ File: messages.tsx      │  │ File: create.tsx        │                 │
│  │ 29 سطر ⚠️ (جزئي)        │  │ 273 سطر ✅              │                 │
│  └─────────────────────────┘  └─────────────────────────┘                 │
│                                                                               │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 إحصائيات الملفات:

```
الملف                      السطور    الحالة    الأهمية
─────────────────────────────────────────────────────────
login.tsx                  246       ✅      🔴 حرج
index.tsx                  565       ✅      🔴 حرج
create.tsx                 273       ✅      🟠 مهم
[patientId].tsx           800+       ✅      🔴 حرج
team.tsx                   419       ✅      🟠 مهم
settings.tsx              660        ✅      🟠 مهم
messages.tsx               29        ⚠️      🔴 حرج
navigationGuards.ts        ~200      ✅      🟠 مهم
─────────────────────────────────────────────────────────
المجموع:                 ~3,900     85%

✅ مكتمل:    ~3,600 سطر
⚠️ ناقص:      ~300 سطر
```

---

## 🎯 الخلاصة البصرية:

```
شاشة الترحيب (Welcome)
       ↓
تسجيل الدخول (Login) ✅ 100%
       ↓
لوحة المرضى (Dashboard) ✅ 95%
    ↙    ↓      ↓    ↘
   /      |      |      \
Settings  Team  Create  Messages
  ✅ 95%  ✅     ✅     ⚠️ 10%
   
وعند الضغط على مريض:
تفاصيل المريض (Details) ✅ 100%
     ↓
Jلسات + رسائل ✅ 100%
     ↓
عرض الصورة (Viewer) ✅ 100%
     ↓
أدوات التحرير ✅ 100%
```

---

**مجموع التكمل: 85% ✅**

